<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jasmine/2.3.4/jasmine.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jasmine/2.3.4/jasmine.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jasmine/2.3.4/jasmine-html.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jasmine/2.3.4/boot.js"></script>
    </head>
    <body>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/promiz/1.0.4/promiz.js"></script>
        <script src="webcrypto-shim.js"></script>
        <script>
            function s2b ( s ) {
                var b = new Uint8Array(s.length);
                for ( var i = 0; i < s.length; i++ ) b[i] = s.charCodeAt(i);
                return b;
            }

            function b2s ( b ) {
                if ( b instanceof ArrayBuffer ) b = new Uint8Array(b);
                return String.fromCharCode.apply( String, b );
            }

            function x2b ( s ) {
                if ( s.length % 2 ) s = '0'+s;
                var b = new Uint8Array(s.length/2);
                for ( var i = 0; i < s.length; i += 2 ) {
                    b[i>>1] = parseInt( s.substr(i,2), 16 );
                }
                return b;
            }

            function b2x ( ab ) {
                var b = new Uint8Array(ab), s = '';
                for ( var i = 0; i < b.length; i++ ) {
                    var h = b[i].toString(16);
                    if ( h.length < 2 ) s += '0';
                    s += h;
                }
                return s;
            }

            function extend ( o, x ) {
                var r = {};
                for ( var k in o ) r[k] = o[k];
                for ( var k in x ) r[k] = x[k];
                return r;
            }

            function normalizeAlg ( a ) {
                if ( typeof a === 'string' ) a = { name: a };
                if ( typeof a.hash === 'string' ) a.hash = { name: a.hash };
                var r = {};
                for ( var p in a ) r[p] = a[p];
                r.name = r.name.toUpperCase().replace('V','v');
                if ( r.hash ) r.hash = { name: r.hash.name.toUpperCase() };
                if ( r.publicExponent ) r.publicExponent = new Uint8Array(r.publicExponent);
                return r;
            };

            describe( 'Util', function () {
                it( 's2b', function () {
                    expect( s2b('') ).toEqual( new Uint8Array() );
                    expect( s2b('a') ).toEqual( new Uint8Array([97]) );
                    expect( s2b( unescape( encodeURIComponent("\uD83D\uDE80") ) ) ).toEqual( new Uint8Array([0xF0,0x9F,0x9A,0x80]) ); // Unicode ROCKET
                });

                it( 'b2s', function () {
                    expect( b2s( new Uint8Array() ) ).toBe('');
                    expect( b2s( new Uint8Array([97]) ) ).toBe('a');
                    expect( decodeURIComponent( escape( b2s( new Uint8Array([0xF0,0x9F,0x9A,0x80]) ) ) ) ).toBe("\uD83D\uDE80"); // Unicode ROCKET
                });

                it( 'x2b', function () {
                    expect( x2b('') ).toEqual( new Uint8Array() );
                    expect( x2b('0') ).toEqual( new Uint8Array(1) );
                    expect( x2b('10203') ).toEqual( new Uint8Array([1,2,3]) );
                });

                it( 'b2x', function () {
                    expect( b2x( new ArrayBuffer() ) ).toBe( '' );
                    expect( b2x( new Uint8Array(1) ) ).toBe( '00' );
                    expect( b2x( new Uint8Array([1,2,3]) ) ).toBe( '010203' );
                });

                it( 'normalizeAlg', function () {
                    expect( normalizeAlg('sha-1') ).toEqual( { name: 'SHA-1' } );
                    expect( normalizeAlg('Sha-256') ).toEqual( { name: 'SHA-256' } );
                    expect( normalizeAlg( { name: 'hmac', hash: 'sha-1' } ) ).toEqual( { name: 'HMAC', hash: { name: 'SHA-1' } } );
                    expect( normalizeAlg( { name: 'hmac', hash: 'sha-1', length: 160 } ) ).toEqual( { name: 'HMAC', hash: { name: 'SHA-1' }, length: 160 } );
                });
            });
        </script>
        <script src="test/crypto.js"></script>
        <script src="test/alg/sha-1.js"></script>
        <script src="test/alg/sha-256.js"></script>
        <script src="test/alg/sha-384.js"></script>
        <script src="test/alg/sha-512.js"></script>
        <script src="test/alg/hmac_sha-1.js"></script>
        <script src="test/alg/hmac_sha-256.js"></script>
        <script src="test/alg/hmac_sha-384.js"></script>
        <script src="test/alg/hmac_sha-512.js"></script>
        <script src="test/alg/aes-cbc.js"></script>
        <script src="test/alg/aes-gcm.js"></script>
        <script src="test/alg/rsassa-pkcs1_sha-1.js"></script>
        <script src="test/alg/rsassa-pkcs1_sha-256.js"></script>
        <script src="test/alg/rsa-oaep_sha-1.js"></script>
        <script src="test/alg/rsa-oaep_sha-256.js"></script>
    </body>
</html>
